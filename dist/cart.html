<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<script src="jquery.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="css/cart.css" />
		<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" type="text/css" href="font01/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="font/iconfont.css" />
	</head>
	<body>
		<div class="top">
			<div class="warp cl">
				<span class="top-link">
					您好，欢迎&nbsp;&nbsp;<i class="phonenumber" style="font-size:18px;background:#dedede;color:red"></i>来到 <em class="s-name">中酒网！</em>
					<a href="/">去首页</a>
				</span>
				<ul class="login-regin">
					<li class="L-line"> <a href="login.html">请登录</a></li>
					<li> <a href="register.html">免费注册</a></li>
				</ul>
				<ul class="quick_list">
					<li>
						<div class="btn-group">
							<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" style="border:none;background: #F5F4F4;outline: none;">
								我的中酒网 <span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu">
								<li><a href="#">已买到的商品</a></li>
								<li><a href="#">我关注的商品</a></li>
								<li><a href="#">我关注的店铺</a></li>
							</ul>
						</div>
					</li>

					<li><em class="shopping-cart"></em><a target="_blank" href="/cart/cart">购物车<em><span id="shopping-amount">0</span></em>件</a></li>
					<li class="moblie-qrcode dropdown">
						<span class="outline"></span>
						<span class="blank"></span>
						<a href="javascript:void(0)">微信端</a>
						<div class="dropdown-menu">
							<img src="http://img6.zhongjiu.cn/resourceb2b2c//Storage/Plat/Site/qrCode.png" width="90" height="90">
						</div>
					</li>
					<li class="app-qrcode dropdown service">
						<span class="outline"></span>
						<span class="blank"></span>
						<a href="javascript:void(0)">APP</a>
						<div class="dropdown-menu">
							<img width="90" height="90" src="http://img6.zhongjiu.cn/ResourceB2B2C/App/mob.jpg">
							<h3>扫描二维码</h3>
							<p>下载手机客户端</p>
						</div>

					</li>
					<li class="service dropdown">
						<span class="outline"></span>
						<span class="blank"></span>
						<a href="/selleradmin">卖家中心<b></b></a>
						<div class="dropdown-menu">
							<ol>

							</ol>
						</div>
					</li>
					<li class="service dropdown">
						<span class="outline"></span>
						<span class="blank"></span>
						<a href="javascript:void(0)">订购热线:400-798-99</a>
					</li>
				</ul>
			</div>
		</div>

		<div class="w990">
			<img src="imgs/zj%20(2).png" height="60" title="返回商城首页" alt="返回商城首页">
			<div class="line"></div>
			<ul class="progress">
				<li class="step-1">1.我的购物车</li>
				<li class="step-2" style="color:#62c92b;">2.填写核对订单信息</li>
				<li class="step-3">3.成功提交订单</li>
			</ul>
		</div>
		<div class="cart">
			<div class="pay">
				<div>全选<input type="checkbox" id="allcheck" class="box" /></div>
				<span>商品信息</span>
				<span>数量</span>
				<span>单价</span>
				<span>金额</span>
			</div>
			<ul id="cartlist"></ul>
			<div id="totalprice" style="float:right;margin-right:160px;font-size:24px;margin-top:30px;font-weight:900;">合计金额:&nbsp;&nbsp;&nbsp;0</div>
		</div>
		
		
		
		<div class="footer">
			<div class="ensure">
				<div class="wrap1190">
					<dl class="fl">
						<dt class="icon iconfont fl" style="color:#E00009;font-size: 40px;">&#xe667;</dt>
						<dd class="fr">
							<h3>正品保障</h3>
							<p>厂家直接 正品防伪</p>
						</dd>
					</dl>
					<dl class="fl">
						<dt class="icon iconfont fl" style="color:#E00009;font-size: 40px;">&#xe654;</dt>
						<dd class="fr">
							<h3>领军o2o</h3>
							<p>中国酒类 o2o第一家</p>
						</dd>
					</dl>
					<dl class="fl">
						<dt class="icon iconfont f1" style="color:#E00009;font-size: 40px;">&#xe604;</dt>
						<dd class="fr">
							<h3>无理由退货</h3>
							<p>拆封无条件退货</p>
						</dd>
					</dl>
					<dl class="fl">
						<dt class="icon iconfont f1" style="color:#E00009;font-size: 40px;">&#xe602;</dt>
						<dd class="fr">
							<h3>闪电配送</h3>
							<p>专业配送 安全送达</p>
						</dd>
					</dl>
					<dl class="fl">
						<dt class="icon iconfont f1" style="color:#E00009;font-size: 40px;">&#xe619;</dt>
						<dd class="fr">
							<h3>百万口碑</h3>
							<p>400万用户的认可</p>
						</dd>
					</dl>
					<dl class="fl">
						<dt class="icon iconfont f1" style="color:#E00009;font-size: 40px;">&#xe68c;</dt>
						<dd class="fr">
							<h3>金牌服务</h3>
							<p>7*12小时贴心服务</p>
						</dd>
					</dl>
				</div>
			</div>
			<div class="fservice">
				<div class="wrap1190 clearfix" style="height: 180px;">
		
					<dl class="linkothers">
						<dd><a title="" id="Foot_zj" href="http://www.zhongjiu.cn" target="_blank"><img src="imgs/zj.png"></a></dd>
						<dd><a title="" id="Foot_ls" href="http://www.zhongjiu.cn" target="_blank"><img src="imgs/ls2.png"></a></dd>
		
					</dl>
		
		
					<dl>
						<dt>购物指南</dt>
						<dd>
							<a title="购物流程" href="/HelpDetail/1.htm" target="_blank">购物流程</a>
						</dd>
						<dd>
							<a title="用户注册协议" href="/HelpDetail/23.htm" target="_blank">用户注册协议</a>
						</dd>
						<dd>
							<a title="会员积分" href="/HelpDetail/33.htm" target="_blank">会员积分</a>
						</dd>
						<dd>
							<a title="关于发票" href="/HelpDetail/34.htm" target="_blank">关于发票</a>
						</dd>
						<dd>
							<a title="关于优惠券" href="/HelpDetail/42.htm" target="_blank">关于优惠券</a>
						</dd>
						<dd>
							<a title="开票说明 " href="/HelpDetail/69.htm" target="_blank">开票说明 </a>
						</dd>
					</dl>
					<dl>
						<dt>配送说明</dt>
						<dd>
							<a title="关于运费" href="/HelpDetail/13.htm" target="_blank">关于运费</a>
						</dd>
						<dd>
							<a title="快递查询" href="/HelpDetail/15.htm" target="_blank">快递查询</a>
						</dd>
						<dd>
							<a title="发货与签收" href="/HelpDetail/16.htm" target="_blank">发货与签收</a>
						</dd>
					</dl>
					<dl>
						<dt>支付方式</dt>
						<dd>
							<a title="支付宝支付" href="/HelpDetail/6.htm" target="_blank">支付宝支付</a>
						</dd>
						<dd>
							<a title="微信支付" href="/HelpDetail/37.htm" target="_blank">微信支付</a>
						</dd>
						<dd>
							<a title="账户余额支付" href="/HelpDetail/39.htm" target="_blank">账户余额支付</a>
						</dd>
					</dl>
					<dl>
						<dt>售后服务</dt>
						<dd>
							<a title="热门常见问题" href="/HelpDetail/2.htm" target="_blank">热门常见问题</a>
						</dd>
						<dd>
							<a title="服务承诺" href="/HelpDetail/9.htm" target="_blank">服务承诺</a>
						</dd>
						<dd>
							<a title="退款说明" href="/HelpDetail/10.htm" target="_blank">退款说明</a>
						</dd>
						<dd>
							<a title="退换货政策" href="/HelpDetail/11.htm" target="_blank">退换货政策</a>
						</dd>
						<dd>
							<a title="退换货流程" href="/HelpDetail/12.htm" target="_blank">退换货流程</a>
						</dd>
					</dl>
					<dl>
						<dt>服务保障</dt>
						<dd>
							<a title="30分钟快速响应" href="/HelpDetail/17.htm" target="_blank">30分钟快速响应</a>
						</dd>
						<dd>
							<a title="7*12小时贴心服务" href="/HelpDetail/18.htm" target="_blank">7*12小时贴心服务</a>
						</dd>
					</dl>
					<dl class="weixin">
						<dt>中酒微信</dt>
						<dd><a title="" href="#" target="_blank">中酒官方微信</a></dd>
					</dl>
					<dl class="web">
						<dt>手机中酒</dt>
						<dd>下载移动客户端</dd>
					</dl>
				</div>
			</div>
			<div class="link">
				<a title="" href="http://www.zhongjiu.cn/Article/Details/25" target="_blank">关于中酒</a>
				<a title="" href="http://www.zhongjiu.cn/Article/Details/31" target="_blank">媒体报道 </a>
				<a title="" href="http://www.zhongjiu.cn/Article/Details/26" target="_blank">商务合作</a>
		
				<a title="" href="http://www.zhongjiu.cn/Article/Details/28 " target="_blank">加入中酒</a>
				<a title="" href="http://pro.zhongjiu.cn/jiameng/jiameng.html" target="_blank"> 商家加盟</a>
				<a title="" href="http://www.zhongjiu.cn/Article/Details/30" target="_blank">联系我们</a>
			</div>
			<div class="copyright">
				<p style="font-size: 12px">Copyright © 2016 中酒网(www.zhongjiu.cn) 版权所有 京ICP备12022216号-2 | 京公网安备 11010502026701 |
					购买前请确认达到法定饮酒年龄！中酒网不销售任何含酒精产品给18岁以下人士！</p>
				<p style="padding-bottom:10px;font-size: 12px;">公司名称：中酒时代酒业（北京）有限公司&nbsp;公司地址：北京市朝阳区高碑店乡半壁店村惠河南街1111号国投尚科大厦2层E202单元办公室&nbsp;联系人：刘铮&nbsp;联系方式：400-798-9999&nbsp;社会信用代码证：911101055938071245&nbsp;食品经营许可证</p>
				<div class="beian">
					<a title="" href="https://credit.szfw.org/CX20141229006205006302.html" target="_blank"><img src="imgs/authentication_05.png"></a>
					<a title="" href="http://www.anquan.org/seccenter/search/www.zhongjiu.cn" target="_blank"><img src="imgs/authentication_07.png"></a>
					<a title="" href="http://img5.zhongjiu.cn/webcommon/bottom/_34A01861.jpg" target="_blank"><img src="imgs/authentication_09.png"></a>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			$(function() {
				var token = location.search.split("&")[0].split("=")[1];
				var name = location.search.split("&")[1].split("=")[1];
				console.log(token);
				$(".phonenumber").html(name);
				$.post("http://47.104.244.134:8080/cartlist.do", {
					token:token
				}).done(data => {
					var str = "";
					var url = "";
					for(let i=0;i<data.length;i++){
						console.log(data);											
							var data1 = data[i].goods;
							var count1 =data[i].count;
							console.log(count1);
							if (data1.picurl == "") {
								url = "imgs/photo.jpg"
							} else {
								url = data1.picurl;
							}
							str +=
								`<li style="padding-top:15px;height:100px;">
							<div><input type="checkbox" id="checkbox01" class="boox"/></div>
							<div><img src="${url}" style="width:50px;height:50px"/></div>
							<div class="nums"><span class="sp1">${data1.name}</span></div>
							<div class="numbers">
								<span class="minus" style="cursor:pointer">-</span>
								<input class="box num" type="text" value="${count1}" >
								<span class="plus" style="cursor:pointer">+</span>
							</div>
						<div class="price"><span class="sp1">${data1.price}</span></div>
							
						<div class="money"><span class="sp1">${data1.price* count1 }</span></div>
						
						<div class="del" data-id="${data[i].id}" data-gid="${data[i].gid}">删除</div>
						</li>`
							
					}	
					//上面的<div class="del">里面加进去了（data-id；data-gid两个属性）把后台需要传入的数据作为他们的属性值,便于我们存取调用
						$("#cartlist").html(str);
						
						
						
						//点击删除对应节点，同时调用封装函数更新后台数据库数据
						$(".del").click(function(){
							//console.log($(this).parent())
							$(this).parent().remove();
							var m =$(this).attr("data-id");
							var n =$(this).attr("data-gid");
							
							doo(m,n,0);
						})
						
						//封装接口函数
						function doo(m,n,num){
							$.get("http://47.104.244.134:8080/cartupdate.do",{
							 	id:m,
							 	gid:n,
							 	num:num,
								token:token,
							}).done(data=>{
								console.log(data);//{code: 0, msg: "成功", data: null}
							 })
						}
						
						
						
						
						//数量减少，同时调用封装函数更新数据库数据
						$(".minus").click(function(){
							//console.log($(this).next())
							var count=Number($(this).next().val());
							count--;
							if(count<=1){
								$(this).next().val(1);
							}else{
								$(this).next().val(count);
							}
							
							var m =$(".del").attr("data-id");
							var n =$(".del").attr("data-gid");
							
							doo(m,n,-1);							
							var b=$(this).parent().next().find(".sp1").eq(0).text();
							var sum=$(this).next().val()*b;
							$(this).parent().nextAll(".money").text(sum);
								$("#totalprice").text(tpeice());
								
						})
						
							//增加数量，同时调用封装函数更新数据库数据
						$(".plus").click(function(){
							var count=Number($(this).prev().val());
							count++;
							$(this).prev().val(count);
							var m =$(".del").attr("data-id");
							var n =$(".del").attr("data-gid");
							
							doo(m,n,1);
							var a=$(this).prev().val();
							var b=$(this).parent().next().find(".sp1").eq(0).text();
							var sum=a*b;
							$(this).parent().nextAll(".money").text(sum);
							$("#totalprice").text(tpeice());
						})
						
						//鼠标失去焦点，num值发生变化(先调用cartupdate接口清空数据，再调cartsave接口循环添加数据进后台)
						$(".num").each(function(){
							$(this).blur(function(){
								var count=$(this).val();
								var sum=count*$(this).parent().next().eq(0).text();
								$(this).parent().nextAll(".money").text(sum);
								var m =$(".del").attr("data-id");
								var n =$(".del").attr("data-gid");
								
								$.get("http://47.104.244.134:8080/cartupdate.do",{
								 	id:m,
								 	gid:n,
								 	num:0,
									token:token,
								}).done(data=>{
									for(var i=0;i<count;i++){
										$.get("http://47.104.244.134:8080/cartsave.do", {
											gid: n,
											token:token
										}).done(data => {					
											console.log(data);
										})
									}
								 })
								$("#totalprice").text(tpeice());
							})
						})
						
						
					//check(全选)判定
					$("#allcheck").click(function(){
											
				   $(".boox").prop("checked",$(this).prop("checked"));
				   if($(this).prop("checked"))	{
					   $(".boox").addClass("select");
					   $(".boox").prop("checked",true)
				   }else{
					   $(".boox").removeClass("select")
				   } 
				   if($(this).prop("checked")){
				   	$("#totalprice").text(tpeice());
				   }else{
				   	$("#totalprice").text(tpeice());
				   }
			})
					
					
					$(".boox").click(function(){	
						if($(this).prop("checked")){
							$(this).addClass("select");
						if($(".boox:checked").length==$(".boox").length){
								$("#allcheck").prop("checked",true);}
						}
						else{
							$(this).removeClass("select");
							$("#allcheck").prop("checked",false);
						}
						$("#totalprice").text(tpeice());			
					})
				})	
					
				
				function  tpeice(){
				var sum=0;
				$(".select").each(function(){
				sum+=Number($(this).parent().nextAll(".money").text());
					})
				return sum;
				}	
			})
		</script>
	</body>
</html>
